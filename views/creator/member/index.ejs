<div class="content">
  <div class="limit_member_page">
    <div class="member_page">
      <%- include('./navbar.ejs')%>
        <table>
          <thead>
            <tr>
              <th>No.</th>
              <th>Img</th>
              <th>Name</th>
              <th>Email</th>
              <th>Current Tier</th>
              <th>Join Date</th>
              <th>Last Charge Date</th>
              <th>Next Charge Date</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="member_list_data">
          </tbody>
        </table>
    </div>
  </div>
</div>

<script>

  function formatDate(dateString) {
    const options = { year: 'numeric', month: '2-digit', day: '2-digit' };
    return new Date(dateString).toLocaleDateString('en-GB', options);
  }

  window.onload = async function () {
    fetch('/member/creator')
      .then(response => response.json())
      .then(memberlist => {

        let html = '';

        if (memberlist.length > 0) {
          for (var count = 0; memberlist.length > count; count++) {
            html += '<tr>';
            html += '<td>' + (count + 1) + '</td>';
            html += '<td><img src="' + memberlist[count].img + '" alt="user_profile" class="img_member_profile"></td>';
            html += '<td>' + memberlist[count].name + '</td>';
            html += '<td>' + memberlist[count].email + '</td>';
            html += '<td>' + memberlist[count].package_name + '</td>';
            html += '<td>' + formatDate(memberlist[count].create_date) + '</td>';
            html += '<td>' + formatDate(memberlist[count].start_date) + '</td>';
            html += '<td>' + formatDate(memberlist[count].end_date) + '</td>'
            const status = memberlist[count].status;
            if (status === 0) {
              html += '<td class="inactive_member">ไม่ได้ใช้งาน</td>';
            } else if (status === 1) {
              html += '<td class="active_member">ใช้งาน</td>';
            } else if (status === 2) {
              html += '<td class="suspended_member">ระงับการใช้งาน</td>';
            } else if (status === 3) {
              html += '<td class="expired_member">หมดอายุ</td>';
            } else if (status === 4) {
              html += '<td class="pending_member">รอการยืนยัน</td>';
            } else if (status === 5) {
              html += '<td class="cancelled_member" >ยกเลิก</td>';
            } else if (status === 6) {
              html += '<td class="renewed_member">ต่ออายุ</td>';
            } else {
              html += '<td class="unknown _member">ไม่ทราบสถานะ</td>';
            }
            html += '<td><i id="tooltip_click" class="material-icons">more_horiz</i></td>';
            html += '</tr>';

          }
        }
        else {

          html += '<tr>';
          html += '<div class="creator_data_no">';
          html += '<span><i class="fa-solid fa-user-xmark"></i></span>';
          html += '<span>ยังไม่ได้สมัครสมาชิก</span>';
          html += '<a href="/search">ค้นหาคริเอเตอร์</a>';
          html += '</div>';
          html += '</tr>';

        }

        const member_list_data = $("#member_list_data");
        member_list_data.empty();
        member_list_data.append(html);

      })
  }

</script>