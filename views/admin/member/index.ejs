<div class="content">
    <div class="limit_member_page">
        <div class="member_page">
            <%- include('./navbar.ejs')%>
                <table>
                    <thead>
                        <tr>
                            <th>ลำดับที่</th>
                            <th>รูปโปรไฟล์</th>
                            <th>ชื่อผู้ใช้</th>
                            <th>อีเมล</th>
                            <th>บทบาท</th>
                            <th>วันที่สร้าง</th>
                        </tr>
                    </thead>
                    <tbody id="member_list_data">
                    </tbody>
                </table>
                <div id="pagination">
                    <button onclick="previousPage()"><</button>
                    <span id="paginationNumbers"></span>
                    <button onclick="nextPage()">></button>
                </div>
        </div>
    </div>
</div>

<script>
    let memberlist; // Define memberlist globally
    const itemsPerPage = 5; // Number of items to show per page
    let currentPage = 1;

    function formatDate(dateString) {
        const options = {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit'
        };
        return new Date(dateString).toLocaleDateString('en-GB', options);
    }

    function renderTable(pageNumber, data) {
        let start = (pageNumber - 1) * itemsPerPage;
        let end = start + itemsPerPage;
        let html = '';

        for (var count = start; count < end && count < data.length; count++) {
            html += '<tr>';
            html += '<td>' + (count + 1) + '</td>';
            html += '<td><img src="' + data[count].img + '" alt="user_profile" class="img_member_profile" onerror="/img/error_profile.png"></td>';
            html += '<td>' + data[count].name + '</td>';
            html += '<td>' + data[count].email + '</td>';
            html += '<td>' + data[count].role + '</td>';
            html += '<td>' + formatDate(data[count].date_user) + '</td>';
            html += '<td><i id="tooltip_click" class="material-icons">more_horiz</i></td>';
            html += '</tr>';
        }

        const member_list_data = $("#member_list_data");
        member_list_data.empty();
        member_list_data.append(html);
    }

    function renderPagination(data) {
        const totalPages = Math.ceil(data.length / itemsPerPage);
        const paginationNumbers = $("#paginationNumbers");
        let html = '';

        for (let i = 1; i <= totalPages; i++) {
            html += '<button onclick="goToPage(' + i + ')">' + i + '</button>';
        }

        paginationNumbers.empty();
        paginationNumbers.append(html);
    }

    function previousPage() {
        if (currentPage > 1) {
            currentPage--;
            renderTable(currentPage, memberlist);

            // Remove 'active' class from all pagination buttons
            $('#paginationNumbers button').removeClass('active');

            // Add 'active' class to the current pagination button
            $('#paginationNumbers button').eq(currentPage - 1).addClass('active');
        }
    }

    function nextPage() {
        const totalPages = Math.ceil(memberlist.length / itemsPerPage);
        if (currentPage < totalPages) {
            currentPage++;
            renderTable(currentPage, memberlist);

            // Remove 'active' class from all pagination buttons
            $('#paginationNumbers button').removeClass('active');

            // Add 'active' class to the current pagination button
            $('#paginationNumbers button').eq(currentPage - 1).addClass('active');
        }
    }

    function goToPage(page) {

        currentPage = page;
        renderTable(currentPage, memberlist);

        // Remove the 'active' class from all pagination buttons
        $('#paginationNumbers button').removeClass('active');

        currentPage = page;
        renderTable(currentPage, memberlist);

        // Add the 'active' class to the current pagination button
        $('#paginationNumbers button').eq(currentPage - 1).addClass('active');
    }

    window.onload = async function () {
        const response = await fetch('/member/admin');
        memberlist = await response.json(); // Assign to global memberlist

        renderTable(1, memberlist);
        renderPagination(memberlist);

        $('#paginationNumbers button:first').addClass('active');
    }


</script>